<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8" />

  <title>easynote | list</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src='//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script src='//cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js'></script>

  <link rel="stylesheet" href="[root]/css/easynote.css">
  <script src="[root]/js/easynote.api.js"></script>

  <style>
    /*form styles*/
    #msform {
      width: 100%;
      margin: 50px auto;
      text-align: left;
      /*text-align: center;*/
      position: relative;
    }

    .container {
      width: 100%;
      margin: auto;
      padding: 10px;
      /*border: 1px solid #fff;*/
    }
    .list-group-item {
      text-align: left;
    }
  </style>  
  
  <script>
    $(document).ready(function () {
      easynote_set_root('[root]')

      $('.loginbox').hide();
      $('.logoutbox').hide();
      var islogin = easynote_api_is_login();
      if (islogin) {
          $('.logoutbox').show();
      }
      else {
          $('.loginbox').show();
      }

        $('.list-group').empty();
        list_easynote();
    });

    function go_writepage() {
      window.location.href = '[root]/write';
    }
    function go_readpage(num) {
      window.location.href = '[root]/read/' + num;
    }

    function getYYYYMMDD(date) {
        // return "yyyy-mm-dd"
        var d = new Date();
        if (date) d = date;
        return d.getFullYear() + "-" + ((d.getMonth() + 1) > 9 ? (d.getMonth() + 1).toString() : "0" + (d.getMonth() + 1)) + "-" + (d.getDate() > 9 ? d.getDate().toString() : "0" + d.getDate().toString());
    }
    function getYYYYMMDD_HHIISS(date) {
        // return "yyyy-mm-dd"
        var d = new Date();
        if (date) d = date;
        return d.getFullYear() + "-" + ((d.getMonth() + 1) > 9 ? (d.getMonth() + 1).toString() : "0" + (d.getMonth() + 1)) + "-" + (d.getDate() > 9 ? d.getDate().toString() : "0" + d.getDate().toString()) + " " +
              (d.getHours() > 9 ? d.getHours().toString() : "0" + d.getHours().toString()) + ":" + (d.getMinutes() > 9 ? d.getMinutes().toString() : "0" + d.getMinutes().toString()) + ":" + (d.getSeconds() > 9 ? d.getSeconds().toString() : "0" + d.getSeconds().toString());
    }
    function getFullYmdStr(date){
        // retrn "yyyy년 mm월 dd일 hh시 ii분 ss초 fff요일"
        var d = new Date();
        if (date) d = date;            
        return d.getFullYear() + "년 " + (d.getMonth()+1) + "월 " + d.getDate() + "일 " + d.getHours() + "시 " + d.getMinutes() + "분 " + d.getSeconds() + "초 " +  '일월화수목금토'.charAt(d.getUTCDay())+'요일';
    }
    function calcDateDiff(type, date1, date2){
      //두 날짜 사이의 간격을 type 으로 계산해 출력
        let ret = Math.abs(date1 - date2);
        switch(type){
            case 'day':
                ret /= 24;
            case 'hour':
                ret /= 60;
            case 'min':
                ret /= 60;
            case 'sec':
                ret /= 1000;
        }
        return Math.round(ret);
    }

    function list_easynote(page) {
      // list api
      $.ajax({
          type: "POST",
          url: "[root]/list",
          data: { },
          success: function (response) {
              let result = response["result"];

              var success = result['success'];
              var message = result['message'];

              if (success == true) {
                var row = result['row'];
                for (let i = 0; i < row.length; i++) {
                    let num = row[i]['num']
                    let name = row[i]['name']
                    let note = row[i]['note']
                    let id = row[i]['id']
                    let access = row[i]['access']
                    let date = row[i]['date']

                    var notelist = note.split("\n");
                    var display_note = '';
                    for(var j = 0; j < notelist.length && j < 3; j++) { // 3줄만 표시
                      display_note += notelist[j] + "\n";
                    }

                    // display time
                    var sysdate = new Date([systemdate]);
                    var display_date = getYYYYMMDD_HHIISS(new Date(date));
                    var day_gap = calcDateDiff('day', sysdate, new Date(date));
                    var display_date_gap = (day_gap <= 1) ? day_gap + ' day ago' : day_gap + ' days ago';
                    if (day_gap <= 0) { display_date_gap = display_date; }

                    let temp_html = `<a onclick="go_readpage(${num})" class="list-group-item list-group-item-action" aria-current="true">
                                      <div class="d-flex w-100 justify-content-between">
                                        <small class="mb-num">#${num}</small>
                                        <h5 class="mb-title">${name}</h5>
                                        <small class="mb-date">${display_date_gap}</small>
                                      </div>
                                      <p class="mb-note">${display_note}</p>
                                      <small>..더보기..</small>
                                    </a>`
                    $('.list-group').append(temp_html)
                }
              }
              else {
                  alert(message);
              }

              
          }
      })
    }

</script>
</head>

<body>

<!-- multistep form -->
<form id="msform">
    <!-- fieldsets -->
    <fieldset>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <div class="loginbox"><li class="breadcrumb-item"><a href="[root]/login">login</a></li></div>
          <div class="logoutbox"><li class="breadcrumb-item"><a href="#" onclick="easynote_api_logout('[root]')">logout</a></li></div>
          &nbsp; | &nbsp;
          <li class="breadcrumb-item"><a href="[root]">home</a></li>
        </ol>
      </nav>
      

      <h2 class="fs-title">Easynote List</h2>
      <hr class="title-underline">
      <h3 class="fs-subtitle">This is an easynote list page. You can scroll for paging.</h3>

      
      <div class="container">
        <div class="buttons">
          <div class="d-grid gap-2 d-md-block">
            <button class="btn btn-primary" type="button" onclick="go_writepage()">write</button>
          </div>
        </div>
        <br>


        <div class="list-group">
          <a href="#" onclick="go_readpage(0)" class="list-group-item list-group-item-action active" aria-current="true">
            <div class="d-flex w-100 justify-content-between">
              <small>#3</small>
              <h5 class="mb-1">테스트 제목</h5>
              <small>3 days ago</small>
            </div>
            <pre class="mb-1">테스트\n간단한 내용 보이기..\n블라블라</pre>
            <small>..더보기..</small>
          </a>
        </div>
      </div>
      

    </fieldset>
  </form>
  
</body>

</html>

